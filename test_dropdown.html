<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a1a; color: #ffffff; padding: 20px; }
        .dropdown-menu-dark { background-color: #2d2d2d; border: 1px solid #404040; }
        .dropdown-menu-dark .dropdown-item { color: #ffffff; }
        .dropdown-menu-dark .dropdown-item:hover { background-color: #404040; }
        .symbol-text { font-weight: bold; display: block; }
        .exchange-text { color: #888; font-size: 10px; text-transform: uppercase; display: block; margin-top: 0.25rem; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Symbols Dropdown Test</h2>
        
        <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle btn btn-primary" href="#" id="symbolsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-list-ul"></i> SYMBOLS
            </a>
            <ul class="dropdown-menu dropdown-menu-dark" id="symbolsDropdownMenu" aria-labelledby="symbolsDropdown">
                <li><div class="dropdown-header">Loading symbols...</div></li>
            </ul>
        </div>
        
        <div id="debug" class="mt-3 p-3 bg-dark">
            <h5>Debug Info:</h5>
            <div id="debugContent">Waiting for dropdown to load...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        async function populateSymbolsDropdown() {
            try {
                const response = await fetch('/api/symbols');
                const data = await response.json();
                
                document.getElementById('debugContent').innerHTML = `API Response: ${JSON.stringify(data, null, 2)}`;
                
                if (data.success && data.symbols) {
                    const dropdownMenu = document.getElementById('symbolsDropdownMenu');
                    
                    // Clear loading message
                    dropdownMenu.innerHTML = '';
                    
                    if (data.symbols.length === 0) {
                        dropdownMenu.innerHTML = '<li><div class="dropdown-header">No symbols found</div></li>';
                        return;
                    }
                    
                    // Add symbols to dropdown
                    data.symbols.forEach(symbolData => {
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        
                        link.className = 'dropdown-item';
                        link.href = symbolData.url;
                        link.innerHTML = `
                            <span class="symbol-text">${symbolData.symbol}</span>
                            <small class="exchange-text">${symbolData.exchange}</small>
                        `;
                        
                        listItem.appendChild(link);
                        dropdownMenu.appendChild(listItem);
                    });
                    
                    // Add separator and add entry link
                    const separator = document.createElement('li');
                    separator.innerHTML = '<hr class="dropdown-divider">';
                    dropdownMenu.appendChild(separator);
                    
                    const addEntryItem = document.createElement('li');
                    const addEntryLink = document.createElement('a');
                    addEntryLink.className = 'dropdown-item';
                    addEntryLink.href = '/add';
                    addEntryLink.innerHTML = '<i class="bi bi-plus-circle"></i> Add New Entry';
                    addEntryItem.appendChild(addEntryLink);
                    dropdownMenu.appendChild(addEntryItem);
                    
                } else {
                    console.error('Failed to load symbols:', data.error || 'Unknown error');
                    const dropdownMenu = document.getElementById('symbolsDropdownMenu');
                    dropdownMenu.innerHTML = '<li><div class="dropdown-header text-danger">Error loading symbols</div></li>';
                }
            } catch (error) {
                console.error('Error fetching symbols:', error);
                document.getElementById('debugContent').innerHTML = `Error: ${error.message}`;
                const dropdownMenu = document.getElementById('symbolsDropdownMenu');
                dropdownMenu.innerHTML = '<li><div class="dropdown-header text-danger">Failed to load symbols</div></li>';
            }
        }
        
        // Populate dropdown when page loads
        document.addEventListener('DOMContentLoaded', populateSymbolsDropdown);
    </script>
</body>
</html>
